{"paragraphs":[{"text":"%pyspark\n\nimport pyspark.sql.functions as f\nfrom pyspark.sql.functions import udf, col, lag, lead\nfrom pyspark.sql.window import Window\nfrom pyspark.sql.types import IntegerType\n\n\nprint(\"https://arena-hadoop.inno.tech:18088/proxy/\" + sc.applicationId)","user":"smykov","dateUpdated":"2021-11-25T12:09:08+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"https://arena-hadoop.inno.tech:18088/proxy/application_1637409254228_0220\n"}]},"apps":[],"jobName":"paragraph_1637669170904_1254187971","id":"20211123-150610_75150706","dateCreated":"2021-11-23T15:06:10+0300","dateStarted":"2021-11-25T12:09:08+0300","dateFinished":"2021-11-25T12:09:48+0300","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:58"},{"text":"%pyspark\n\nevents_df = spark.table(\"market.events\").where(\"date < '2019-11-02'\")\n\nevents_df.show()","user":"smykov","dateUpdated":"2021-11-25T12:09:48+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+----------+-------------------+--------------------+--------+-------+---------+--------------------+----------+\n|          event_time|event_type|product_id|        category_id|       category_code|   brand|  price|  user_id|        user_session|      date|\n+--------------------+----------+----------+-------------------+--------------------+--------+-------+---------+--------------------+----------+\n|2019-11-01 00:00:...|      view|   1003461|2053013555631882655|electronics.smart...|  xiaomi| 489.07|520088904|4d3b30da-a5e4-49d...|2019-11-01|\n|2019-11-01 15:23:...|      view|   1307237|2053013558920217191|  computers.notebook|  lenovo| 301.17|514160399|865c896e-d8f2-4a6...|2019-11-01|\n|2019-11-01 00:00:...|      view|   5000088|2053013566100866035|appliances.sewing...|  janome| 293.65|530496790|8e5f4f83-366c-4f7...|2019-11-01|\n|2019-11-01 15:23:...|      view|   1306759|2053013558920217191|  computers.notebook|    dell| 406.67|566056062|e1647d4d-b8b1-4af...|2019-11-01|\n|2019-11-01 00:00:...|      view|  17302664|2053013553853497655|                null|   creed|  28.31|561587266|755422e7-9040-477...|2019-11-01|\n|2019-11-01 15:23:...|      view|   8801100|2053013555573162395|electronics.telep...|   nokia|  94.66|516045845|0c267f6b-bcf1-484...|2019-11-01|\n|2019-11-01 00:00:...|      view|   3601530|2053013563810775923|appliances.kitche...|      lg| 712.87|518085591|3bfb58cd-7892-48c...|2019-11-01|\n|2019-11-01 15:23:...|      view|   1004858|2053013555631882655|electronics.smart...| samsung| 128.16|561157667|75128aef-79c7-463...|2019-11-01|\n|2019-11-01 00:00:...|      view|   1004775|2053013555631882655|electronics.smart...|  xiaomi| 183.27|558856683|313628f1-68b8-460...|2019-11-01|\n|2019-11-01 15:23:...|      view|   2501143|2053013564003713919|appliances.kitche...|   artel|  36.01|523626400|08c8d2b1-de6f-40f...|2019-11-01|\n|2019-11-01 00:00:...|      view|   1306894|2053013558920217191|  computers.notebook|      hp| 360.09|520772685|816a59f3-f5ae-4cc...|2019-11-01|\n|2019-11-01 15:23:...|      view|   2601719|2053013563970159485|                null|  fiesta| 185.33|531002468|8cc93ac8-cd3d-430...|2019-11-01|\n|2019-11-01 00:00:...|      view|   1306421|2053013558920217191|  computers.notebook|      hp| 514.56|514028527|df8184cc-3694-454...|2019-11-01|\n|2019-11-01 15:23:...|      view|   1801854|2053013554415534427|electronics.video.tv| samsung|1001.05|566502042|3c01024e-874b-4e5...|2019-11-01|\n|2019-11-01 00:00:...|      view|  15900065|2053013558190408249|                null| rondell|  30.86|518574284|5e6ef132-4d7c-473...|2019-11-01|\n|2019-11-01 15:23:...|      view|   1005203|2053013555631882655|electronics.smart...|  xiaomi| 111.53|566501071|bce135f9-3617-4f2...|2019-11-01|\n|2019-11-01 00:00:...|      view|  12708937|2053013553559896355|                null|michelin|  72.72|532364121|0a899268-31eb-46d...|2019-11-01|\n|2019-11-01 15:23:...|      view|   1003306|2053013555631882655|electronics.smart...|   apple|  577.3|513812351|72d49afb-741f-43e...|2019-11-01|\n|2019-11-01 00:00:...|      view|   1004258|2053013555631882655|electronics.smart...|   apple| 732.07|532647354|d2d3d2c6-631d-489...|2019-11-01|\n|2019-11-01 15:23:...|      view|  26201192|2053013563693335403|                null| lucente|  87.26|515207495|80bfb1d7-7132-4bf...|2019-11-01|\n+--------------------+----------+----------+-------------------+--------------------+--------+-------+---------+--------------------+----------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781481_312899418","id":"20211118-215516_1413610769","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:09:49+0300","dateFinished":"2021-11-25T12:09:59+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:59"},{"title":"Добавить колонки category_1, category_2, category_3 с категориями различного уровня","text":"%pyspark\n\ndef split_str(s, pos):\n    if s is None:\n        return None\n        \n    try:\n        return s.split('.')[pos]\n    except:\n        return None\n\nsplit_strUdf = udf(split_str)    \n\ndf_cat = events_df\\\n.select(events_df.columns)\\\n.withColumn(\"cat_1\", split_strUdf(col(\"category_code\"), f.lit(0)))\\\n.withColumn(\"cat_2\", split_strUdf(col(\"category_code\"), f.lit(1)))\\\n.withColumn(\"cat_3\", split_strUdf(col(\"category_code\"), f.lit(2)))\n\n\ndf_cat.show()\n","user":"smykov","dateUpdated":"2021-11-25T12:09:59+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+----------+-------------------+--------------------+--------+-------+---------+--------------------+----------+-----------+--------------+------+\n|          event_time|event_type|product_id|        category_id|       category_code|   brand|  price|  user_id|        user_session|      date|      cat_1|         cat_2| cat_3|\n+--------------------+----------+----------+-------------------+--------------------+--------+-------+---------+--------------------+----------+-----------+--------------+------+\n|2019-11-01 00:00:...|      view|   1003461|2053013555631882655|electronics.smart...|  xiaomi| 489.07|520088904|4d3b30da-a5e4-49d...|2019-11-01|electronics|    smartphone|  null|\n|2019-11-01 15:23:...|      view|   1307237|2053013558920217191|  computers.notebook|  lenovo| 301.17|514160399|865c896e-d8f2-4a6...|2019-11-01|  computers|      notebook|  null|\n|2019-11-01 00:00:...|      view|   5000088|2053013566100866035|appliances.sewing...|  janome| 293.65|530496790|8e5f4f83-366c-4f7...|2019-11-01| appliances|sewing_machine|  null|\n|2019-11-01 15:23:...|      view|   1306759|2053013558920217191|  computers.notebook|    dell| 406.67|566056062|e1647d4d-b8b1-4af...|2019-11-01|  computers|      notebook|  null|\n|2019-11-01 00:00:...|      view|  17302664|2053013553853497655|                null|   creed|  28.31|561587266|755422e7-9040-477...|2019-11-01|       null|          null|  null|\n|2019-11-01 15:23:...|      view|   8801100|2053013555573162395|electronics.telep...|   nokia|  94.66|516045845|0c267f6b-bcf1-484...|2019-11-01|electronics|     telephone|  null|\n|2019-11-01 00:00:...|      view|   3601530|2053013563810775923|appliances.kitche...|      lg| 712.87|518085591|3bfb58cd-7892-48c...|2019-11-01| appliances|       kitchen|washer|\n|2019-11-01 15:23:...|      view|   1004858|2053013555631882655|electronics.smart...| samsung| 128.16|561157667|75128aef-79c7-463...|2019-11-01|electronics|    smartphone|  null|\n|2019-11-01 00:00:...|      view|   1004775|2053013555631882655|electronics.smart...|  xiaomi| 183.27|558856683|313628f1-68b8-460...|2019-11-01|electronics|    smartphone|  null|\n|2019-11-01 15:23:...|      view|   2501143|2053013564003713919|appliances.kitche...|   artel|  36.01|523626400|08c8d2b1-de6f-40f...|2019-11-01| appliances|       kitchen|  oven|\n|2019-11-01 00:00:...|      view|   1306894|2053013558920217191|  computers.notebook|      hp| 360.09|520772685|816a59f3-f5ae-4cc...|2019-11-01|  computers|      notebook|  null|\n|2019-11-01 15:23:...|      view|   2601719|2053013563970159485|                null|  fiesta| 185.33|531002468|8cc93ac8-cd3d-430...|2019-11-01|       null|          null|  null|\n|2019-11-01 00:00:...|      view|   1306421|2053013558920217191|  computers.notebook|      hp| 514.56|514028527|df8184cc-3694-454...|2019-11-01|  computers|      notebook|  null|\n|2019-11-01 15:23:...|      view|   1801854|2053013554415534427|electronics.video.tv| samsung|1001.05|566502042|3c01024e-874b-4e5...|2019-11-01|electronics|         video|    tv|\n|2019-11-01 00:00:...|      view|  15900065|2053013558190408249|                null| rondell|  30.86|518574284|5e6ef132-4d7c-473...|2019-11-01|       null|          null|  null|\n|2019-11-01 15:23:...|      view|   1005203|2053013555631882655|electronics.smart...|  xiaomi| 111.53|566501071|bce135f9-3617-4f2...|2019-11-01|electronics|    smartphone|  null|\n|2019-11-01 00:00:...|      view|  12708937|2053013553559896355|                null|michelin|  72.72|532364121|0a899268-31eb-46d...|2019-11-01|       null|          null|  null|\n|2019-11-01 15:23:...|      view|   1003306|2053013555631882655|electronics.smart...|   apple|  577.3|513812351|72d49afb-741f-43e...|2019-11-01|electronics|    smartphone|  null|\n|2019-11-01 00:00:...|      view|   1004258|2053013555631882655|electronics.smart...|   apple| 732.07|532647354|d2d3d2c6-631d-489...|2019-11-01|electronics|    smartphone|  null|\n|2019-11-01 15:23:...|      view|  26201192|2053013563693335403|                null| lucente|  87.26|515207495|80bfb1d7-7132-4bf...|2019-11-01|       null|          null|  null|\n+--------------------+----------+----------+-------------------+--------------------+--------+-------+---------+--------------------+----------+-----------+--------------+------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781483_1202933239","id":"20211118-220108_317477146","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:10:00+0300","dateFinished":"2021-11-25T12:10:06+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:60"},{"title":"Вывести топ-3 брендов по количеству просмотров для каждой категории 2-го уровня","text":"%pyspark\n\nwindowSpec = Window.partitionBy(\"cat_2\").orderBy(col(\"views_amount\").desc())\n\n\ndf_cat\\\n.where(col(\"brand\").isNotNull())\\\n.where(\"event_type = 'view'\")\\\n.groupBy(\"cat_2\", \"brand\")\\\n.agg(\n    f.count(\"product_id\").alias(\"views_amount\")\n    )\\\n.withColumn(\"rank\", f.row_number().over(windowSpec))\\\n.where(\"rank < 4\")\\\n.orderBy(\"cat_2\", col(\"views_amount\").desc())\\\n.show(truncate=False)","user":"smykov","dateUpdated":"2021-11-25T12:10:07+0300","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+----------+------------+----+\n|cat_2      |brand     |views_amount|rank|\n+-----------+----------+------------+----+\n|null       |lucente   |22057       |1   |\n|null       |cordiant  |14072       |2   |\n|null       |xiaomi    |10463       |3   |\n|accessories|pioneer   |3526        |1   |\n|accessories|starline  |3074        |2   |\n|accessories|kenwood   |1101        |3   |\n|audio      |apple     |14882       |1   |\n|audio      |xiaomi    |6974        |2   |\n|audio      |samsung   |2830        |3   |\n|bag        |karya     |720         |1   |\n|bag        |stanley   |527         |2   |\n|bag        |baden     |460         |3   |\n|bathroom   |santeri   |158         |1   |\n|bathroom   |cersanit  |153         |2   |\n|bathroom   |triton    |121         |3   |\n|bedroom    |sv        |2809        |1   |\n|bedroom    |brw       |2149        |2   |\n|bedroom    |stendmebel|1398        |3   |\n|belt       |petek     |14          |1   |\n|belt       |bond      |10          |2   |\n+-----------+----------+------------+----+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781484_619870750","id":"20211118-220232_1309126510","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:10:07+0300","dateFinished":"2021-11-25T12:10:18+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:61"},{"title":"создание hw_3.tracks для запуска локально (на кластере уже готова)","text":"%pyspark\n\nimport pyspark.sql.functions as f\nfrom pyspark.sql.types import *\n\nsch=ArrayType(StringType());\n\n# скачать датасет: http://37.139.43.86/tracks \n\n# важно что разделитель ', ' с пробелом, иначе пробелы добавятся в значения\ntracks = spark.read.option(\"header\", \"true\") \\\n        .option(\"escape\", '\"') \\\n        .option(\"InferSchema\", \"true\") \\\n        .csv(\"data/tracks.csv\") \\\n        .withColumn(\"release_year\", f.substring(\"release_date\", 1, 4).cast(IntegerType())) \\\n        .withColumn(\"array_artist\", f.split(f.regexp_replace(f.col(\"artists\"), \"[\\]\\[\\']\", \"\"),\", \")) \\\n        .cache() #выделяем год в отдельную колонку и преобразуем колонку с артистами в массив\n\ntracks_exp = tracks.select(  \n                            \"name\", \n                            \"popularity\",\n                            \"danceability\",\n                            \"energy\",\n                            \"speechiness\",\n                            \"acousticness\",\n                            \"liveness\",\n                            \"valence\",\n                            \"release_year\",\n                            \"artists\",\n                            f.explode(f.col(\"array_artist\") ).alias(\"name_artist\")\n                        ) #создаем отдельную таблицу с развернутым массивом артистов\n                        \ntracks_exp.printSchema()\n\nspark.sql(\"create database hw_3\")\ntracks_exp.write.mode(\"overwrite\").saveAsTable(\"hw_3.tracks\")","user":"smykov","dateUpdated":"2021-11-25T12:10:18+0300","config":{"tableHide":false,"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":true,"title":true,"results":{},"enabled":false},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"root\n |-- name: string (nullable = true)\n |-- popularity: integer (nullable = true)\n |-- danceability: double (nullable = true)\n |-- energy: double (nullable = true)\n |-- speechiness: double (nullable = true)\n |-- acousticness: double (nullable = true)\n |-- liveness: double (nullable = true)\n |-- valence: double (nullable = true)\n |-- release_year: integer (nullable = true)\n |-- artists: string (nullable = true)\n |-- name_artist: string (nullable = true)\n\n"}]},"apps":[],"jobName":"paragraph_1637603781484_586926781","id":"20211122-175857_277595720","dateCreated":"2021-11-22T20:56:21+0300","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:62"},{"text":"%pyspark\n\ntracks = spark.table(\"hw_3.tracks\")\ntracks.show()","user":"smykov","dateUpdated":"2021-11-25T12:10:18+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"name":"string","popularity":"string","danceability":"string","energy":"string","speechiness":"string","acousticness":"string","liveness":"string","valence":"string","release_year":"string","artists":"string","name_artist":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+----------+------------+------+-----------+------------+--------+-------+------------+--------------------+--------------------+\n|                name|popularity|danceability|energy|speechiness|acousticness|liveness|valence|release_year|             artists|         name_artist|\n+--------------------+----------+------------+------+-----------+------------+--------+-------+------------+--------------------+--------------------+\n|Pumping On Your S...|        50|       0.461| 0.904|     0.0784|       0.011|   0.835|  0.238|        1999|      ['Supergrass']|          Supergrass|\n|  Mujhe Raat Din Bas|        50|       0.614| 0.469|     0.0338|         0.4|   0.102|  0.657|        1999|      ['Sonu Nigam']|          Sonu Nigam|\n| Message in a Bottle|        50|       0.324| 0.683|     0.0724|      0.0174|   0.206|  0.497|        1999|    ['Machine Head']|        Machine Head|\n|           I'm Shady|        50|       0.841| 0.718|      0.277|      0.0315|   0.122|  0.728|        1999|          ['Eminem']|              Eminem|\n|    Corazón Contento|        50|       0.586| 0.829|     0.0307|       0.157|  0.0689|  0.951|        1999|         ['Marisol']|             Marisol|\n| Jackie - Radio Edit|        50|       0.852| 0.994|     0.0973|      0.0205|   0.357|  0.933|        1999|    ['BZ', 'Joanne']|                  BZ|\n| Jackie - Radio Edit|        50|       0.852| 0.994|     0.0973|      0.0205|   0.357|  0.933|        1999|    ['BZ', 'Joanne']|              Joanne|\n|    Cold Water Music|        50|       0.576| 0.853|     0.0394|     0.00568|   0.241|  0.386|        1999|             ['Aim']|                 Aim|\n|Exiliado en el La...|        50|        0.69| 0.434|      0.035|       0.215|  0.0963|  0.514|        1999|          ['Estopa']|              Estopa|\n|Give Me the Simpl...|        50|       0.538| 0.291|     0.0286|        0.85|   0.133|  0.285|        1999|    ['Steve Tyrell']|        Steve Tyrell|\n|Caleidoscópio - A...|        50|       0.577| 0.494|     0.0465|       0.259|    0.68|  0.567|        1999|['Os Paralamas Do...|Os Paralamas Do S...|\n|    Shock the Monkey|        50|       0.597| 0.952|      0.109|     0.00873|   0.316|  0.568|        1999|    ['Coal Chamber']|        Coal Chamber|\n|     One Good Spliff|        50|       0.617| 0.464|      0.142|       0.497|  0.0724|  0.613|        1999|['Ziggy Marley & ...|Ziggy Marley & Th...|\n|             Jammin'|        50|       0.759| 0.721|      0.111|     0.00802|   0.132|  0.587|        1999|['Bob Marley & Th...|Bob Marley & The ...|\n|             Jammin'|        50|       0.759| 0.721|      0.111|     0.00802|   0.132|  0.587|        1999|['Bob Marley & Th...|             MC Lyte|\n|  D-X-L (Hard White)|        50|       0.696| 0.806|      0.367|       0.082|   0.157|  0.743|        1999|['DMX', 'Drag-On'...|                 DMX|\n|  D-X-L (Hard White)|        50|       0.696| 0.806|      0.367|       0.082|   0.157|  0.743|        1999|['DMX', 'Drag-On'...|             Drag-On|\n|  D-X-L (Hard White)|        50|       0.696| 0.806|      0.367|       0.082|   0.157|  0.743|        1999|['DMX', 'Drag-On'...|             The LOX|\n|     Open Your Heart|        50|       0.655| 0.756|     0.0238|       0.295|  0.0748|  0.598|        1999|        ['Westlife']|            Westlife|\n|Olha O Que O Amor...|        50|       0.584| 0.453|     0.0282|       0.569|  0.0964|  0.163|        1999|  ['Sandy e Junior']|      Sandy e Junior|\n+--------------------+----------+------------+------+-----------+------------+--------+-------+------------+--------------------+--------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781485_1723828110","id":"20211122-182953_1657190380","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:10:18+0300","dateFinished":"2021-11-25T12:10:20+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:63"},{"text":"%pyspark\n\nwindowSpecTracks = Window.partitionBy(\"release_year\").orderBy(col(\"popularity\").desc(), \"name\")\n\ndf_tracks = tracks\\\n.where(col(\"name\").isNotNull())\\\n.withColumn(\"year_rank\", f.dense_rank().over(windowSpecTracks))\\\n.orderBy(\"release_year\", \"year_rank\")\\\n.where(\"year_rank <= 100\")\n\ndf_tracks.where(\"release_year = 2020\").show(truncate=False)","user":"smykov","dateUpdated":"2021-11-25T12:10:20+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-------------------------------+----------+------------+------+-----------+------------+--------+-------+------------+----------------------------+--------------+---------+\n|name                           |popularity|danceability|energy|speechiness|acousticness|liveness|valence|release_year|artists                     |name_artist   |year_rank|\n+-------------------------------+----------+------------+------+-----------+------------+--------+-------+------------+----------------------------+--------------+---------+\n|Save Your Tears                |97        |0.68        |0.826 |0.0309     |0.0212      |0.543   |0.644  |2020        |['The Weeknd']              |The Weeknd    |1        |\n|telepatía                      |97        |0.653       |0.524 |0.0502     |0.112       |0.203   |0.553  |2020        |['Kali Uchis']              |Kali Uchis    |2        |\n|Blinding Lights                |96        |0.514       |0.73  |0.0598     |0.00146     |0.0897  |0.334  |2020        |['The Weeknd']              |The Weeknd    |3        |\n|The Business                   |95        |0.798       |0.62  |0.232      |0.414       |0.112   |0.235  |2020        |['Tiësto']                  |Tiësto        |4        |\n|Bandido                        |94        |0.713       |0.617 |0.0887     |0.122       |0.0962  |0.682  |2020        |['Myke Towers', 'Juhn']     |Myke Towers   |5        |\n|Bandido                        |94        |0.713       |0.617 |0.0887     |0.122       |0.0962  |0.682  |2020        |['Myke Towers', 'Juhn']     |Juhn          |5        |\n|Heartbreak Anniversary         |94        |0.449       |0.465 |0.0791     |0.524       |0.303   |0.543  |2020        |['Giveon']                  |Giveon        |6        |\n|WITHOUT YOU                    |94        |0.662       |0.413 |0.0299     |0.213       |0.134   |0.467  |2020        |['The Kid LAROI']           |The Kid LAROI |7        |\n|Good Days                      |93        |0.436       |0.655 |0.0583     |0.499       |0.688   |0.412  |2020        |['SZA']                     |SZA           |8        |\n|LA NOCHE DE ANOCHE             |93        |0.856       |0.618 |0.286      |0.0303      |0.0866  |0.391  |2020        |['Bad Bunny', 'ROSALÍA']    |Bad Bunny     |9        |\n|LA NOCHE DE ANOCHE             |93        |0.856       |0.618 |0.286      |0.0303      |0.0866  |0.391  |2020        |['Bad Bunny', 'ROSALÍA']    |ROSALÍA       |9        |\n|DÁKITI                         |92        |0.731       |0.573 |0.0544     |0.401       |0.113   |0.145  |2020        |['Bad Bunny', 'Jhay Cortez']|Bad Bunny     |10       |\n|DÁKITI                         |92        |0.731       |0.573 |0.0544     |0.401       |0.113   |0.145  |2020        |['Bad Bunny', 'Jhay Cortez']|Jhay Cortez   |10       |\n|Hecha Pa' Mi                   |92        |0.725       |0.756 |0.0572     |0.362       |0.103   |0.828  |2020        |['Boza']                    |Boza          |11       |\n|Paradise (feat. Dermot Kennedy)|92        |0.632       |0.595 |0.0401     |0.0689      |0.209   |0.435  |2020        |['MEDUZA', 'Dermot Kennedy']|MEDUZA        |12       |\n|Paradise (feat. Dermot Kennedy)|92        |0.632       |0.595 |0.0401     |0.0689      |0.209   |0.435  |2020        |['MEDUZA', 'Dermot Kennedy']|Dermot Kennedy|12       |\n|positions                      |92        |0.737       |0.802 |0.0878     |0.468       |0.0931  |0.682  |2020        |['Ariana Grande']           |Ariana Grande |13       |\n|34+35                          |91        |0.83        |0.585 |0.094      |0.237       |0.248   |0.485  |2020        |['Ariana Grande']           |Ariana Grande |14       |\n|BICHOTA                        |91        |0.863       |0.666 |0.152      |0.212       |0.103   |0.838  |2020        |['KAROL G']                 |KAROL G       |15       |\n|Dynamite                       |91        |0.746       |0.765 |0.0993     |0.0112      |0.0936  |0.737  |2020        |['BTS']                     |BTS           |16       |\n+-------------------------------+----------+------------+------+-----------+------------+--------+-------+------------+----------------------------+--------------+---------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637675912790_538510328","id":"20211123-165832_935805779","dateCreated":"2021-11-23T16:58:32+0300","dateStarted":"2021-11-25T12:10:20+0300","dateFinished":"2021-11-25T12:10:27+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:64"},{"title":"2.1. Какие артисты выпустили наибольшее число песен из годовых топ-100 (по популярности)?","text":"%pyspark\n\ndf_tracks\\\n    .groupBy(\"name_artist\")\\\n    .agg(\n        f.count(\"name\").alias(\"tracks_amount\")\n        )\\\n    .orderBy(\"tracks_amount\", ascending=False)\\\n    .show(truncate=False)","user":"smykov","dateUpdated":"2021-11-29T19:24:04+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------------------+-------------+\n|name_artist                   |tracks_amount|\n+------------------------------+-------------+\n|Billie Holiday                |177          |\n|The Beatles                   |116          |\n|Frank Sinatra                 |115          |\n|Stefan Kaminski               |99           |\n|Dale Carnegie                 |99           |\n|Till Hagen                    |99           |\n|Louis Armstrong               |92           |\n|Doris Day                     |84           |\n|Louis Armstrong & His Hot Five|83           |\n|Benny Goodman                 |83           |\n|Fats Waller                   |75           |\n|Frédéric Chopin               |74           |\n|Teddy Wilson                  |70           |\n|Bix Beiderbecke               |65           |\n|Bing Crosby                   |54           |\n|Django Reinhardt              |53           |\n|Fernando Pessoa               |50           |\n|Vladimir Horowitz             |50           |\n|Arthur Rubinstein             |49           |\n|Peggy Lee                     |48           |\n+------------------------------+-------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781486_1222268220","id":"20211122-183357_1504397782","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:10:27+0300","dateFinished":"2021-11-25T12:10:47+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:65"},{"title":"2.2. Вывести топ артистов, которые чаще других попадали в годовой топ-100 песен по популярности?","text":"%pyspark\n\ndf_tracks\\\n.groupBy(\"name_artist\")\\\n.agg(\n    f.countDistinct(col(\"release_year\")).alias(\"count_artist\")\n    )\\\n.orderBy(\"count_artist\", ascending=False)\\\n.show(truncate=False)","user":"smykov","dateUpdated":"2021-11-25T12:10:47+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------------+------------+\n|name_artist       |count_artist|\n+------------------+------------+\n|Frank Sinatra     |23          |\n|Johnny Cash       |17          |\n|Ella Fitzgerald   |16          |\n|Louis Armstrong   |15          |\n|Lata Mangeshkar   |14          |\n|James Piano Bar   |13          |\n|Elvis Presley     |13          |\n|David Bowie       |13          |\n|Peggy Lee         |13          |\n|Elton John        |13          |\n|Billie Holiday    |13          |\n|Eminem            |12          |\n|Stevie Wonder     |12          |\n|Queen             |12          |\n|Drake             |12          |\n|Snoop Dogg        |11          |\n|The Rolling Stones|11          |\n|Bob Dylan         |11          |\n|Dean Martin       |11          |\n|Kanye West        |11          |\n+------------------+------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781487_992190587","id":"20211122-175857_1498457746","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:10:47+0300","dateFinished":"2021-11-25T12:11:08+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:66"},{"text":"%pyspark\n\ndf_artists = df_tracks\\\n.select(\"name_artist\", \"release_year\")\\\n.dropDuplicates()\\\n.orderBy(\"release_year\")\n\n\nwindowSpecArtists = Window.partitionBy(\"name_artist\").orderBy(\"release_year\")\nwindowSpecArtistsStep = Window.partitionBy(\"name_artist\").orderBy(\"step\")\n\nwindowSpecGrp = Window.partitionBy(\"name_artist\").orderBy(\"release_year\")\nwindowSpecMxYrs = Window.partitionBy(\"grp\", \"name_artist\").orderBy(\"release_year\")\n\n# https://stackoverflow.com/questions/56384625/pyspark-cumulative-sum-with-reset-condition\n\n#x.withColumn(\"grp\", f.sum((f.col(\"C\") == 0).cast(\"int\")).over(Window.orderBy(\"A\"))\n#).withColumn(\"D\", f.sum(f.col(\"C\")).over(Window.partitionBy(\"grp\").orderBy(\"A\"))\n#).drop(\"grp\")\n\n\n#def clean_step(i):\n#    if i is None:\n#        return 0\n        \n#    return 1 if i == 1 else 0\n\n#clean_stepUdf = udf(clean_step)   \n#.withColumn(\"step_clean\", clean_stepUdf(col(\"step\")))\\\n\n\ndf_artists\\\n.where(\"name_artist = 'Drake' or name_artist = 'The Beatles'\")\\\n.withColumn(\"lag\", lag(\"release_year\", 1).over(windowSpecArtists))\\\n.withColumn(\"step\", col(\"release_year\") - col(\"lag\"))\\\n.withColumn(\n            \"step_clean\", f.when(col(\"step\") == 1, 1)\n                            .otherwise(0)\n            )\\\n.withColumn(\"grp\", f.sum((f.col(\"step_clean\") == 0).cast(\"int\")).over(windowSpecGrp))\\\n.withColumn(\"D\", f.sum(f.col(\"step_clean\")).over(windowSpecMxYrs))\\\n.show(40, False)\n\n\n\ndf_artists_clean = df_artists\\\n.withColumn(\"lag\", lag(\"release_year\", 1).over(windowSpecArtists))\\\n.withColumn(\"step\", col(\"release_year\") - col(\"lag\"))\\\n.withColumn(\n            \"step_clean\", f.when(col(\"step\") == 1, 1)\n                            .otherwise(0)\n            )\\\n.withColumn(\"grp\", f.sum((f.col(\"step_clean\") == 0).cast(\"int\")).over(windowSpecGrp))\\\n.withColumn(\"D\", f.sum(f.col(\"step_clean\")).over(windowSpecMxYrs))","user":"smykov","dateUpdated":"2021-11-25T12:11:08+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+-----------+------------+----+----+----------+---+---+\n|name_artist|release_year|lag |step|step_clean|grp|D  |\n+-----------+------------+----+----+----------+---+---+\n|Drake      |2009        |null|null|0         |1  |0  |\n|Drake      |2010        |2009|1   |1         |1  |1  |\n|Drake      |2011        |2010|1   |1         |1  |2  |\n|Drake      |2013        |2011|2   |0         |2  |0  |\n|Drake      |2014        |2013|1   |1         |2  |1  |\n|Drake      |2015        |2014|1   |1         |2  |2  |\n|Drake      |2016        |2015|1   |1         |2  |3  |\n|Drake      |2017        |2016|1   |1         |2  |4  |\n|Drake      |2018        |2017|1   |1         |2  |5  |\n|Drake      |2019        |2018|1   |1         |2  |6  |\n|Drake      |2020        |2019|1   |1         |2  |7  |\n|Drake      |2021        |2020|1   |1         |2  |8  |\n|The Beatles|1963        |null|null|0         |1  |0  |\n|The Beatles|1964        |1963|1   |1         |1  |1  |\n|The Beatles|1965        |1964|1   |1         |1  |2  |\n|The Beatles|1966        |1965|1   |1         |1  |3  |\n|The Beatles|1967        |1966|1   |1         |1  |4  |\n|The Beatles|1968        |1967|1   |1         |1  |5  |\n|The Beatles|1969        |1968|1   |1         |1  |6  |\n|The Beatles|1970        |1969|1   |1         |1  |7  |\n|The Beatles|1973        |1970|3   |0         |2  |0  |\n|The Beatles|2000        |1973|27  |0         |3  |0  |\n+-----------+------------+----+----+----------+---+---+\n\n"}]},"apps":[],"jobName":"paragraph_1637678350165_1744746043","id":"20211123-173910_1071138311","dateCreated":"2021-11-23T17:39:10+0300","dateStarted":"2021-11-25T12:11:08+0300","dateFinished":"2021-11-25T12:11:28+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:67"},{"title":" *2.3. Какие артисты дольше других несколько лет подряд держались в ежегодном топ-100 песен по популярности?","text":"%pyspark\n\ndf_artists_clean\\\n.groupBy(\"name_artist\")\\\n.agg(\n    f.max(\"D\").alias(\"max_years\")\n    )\\\n.withColumn(\"max_years_clean\", (col(\"max_years\") + 1).cast(IntegerType()))\\\n.drop(\"max_years\")\\\n.orderBy(\"max_years_clean\", ascending=False)\\\n.show(truncate=False)\n","user":"smykov","dateUpdated":"2021-11-25T12:11:28+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"title":true,"results":{"0":{"graph":{"mode":"table","height":300,"optionOpen":false,"setting":{"table":{"tableGridState":{},"tableColumnTypeState":{"names":{"name_artist":"string","max_period":"string"},"updated":false},"tableOptionSpecHash":"[{\"name\":\"useFilter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable filter for columns\"},{\"name\":\"showPagination\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable pagination for better navigation\"},{\"name\":\"showAggregationFooter\",\"valueType\":\"boolean\",\"defaultValue\":false,\"widget\":\"checkbox\",\"description\":\"Enable a footer for displaying aggregated values\"}]","tableOptionValue":{"useFilter":false,"showPagination":false,"showAggregationFooter":false},"updated":false,"initialized":false}},"commonSetting":{}}}},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------+---------------+\n|name_artist   |max_years_clean|\n+--------------+---------------+\n|Frank Sinatra |14             |\n|Drake         |9              |\n|David Bowie   |9              |\n|Elvis Presley |8              |\n|The Beatles   |8              |\n|Kanye West    |7              |\n|Elton John    |7              |\n|Teddy Wilson  |6              |\n|KISS          |6              |\n|Billie Holiday|6              |\n|Rihanna       |6              |\n|Bob Dylan     |6              |\n|The Beach Boys|6              |\n|Miles Davis   |5              |\n|Benny Goodman |5              |\n|The Doors     |5              |\n|Billie Eilish |5              |\n|Queen         |5              |\n|José José     |5              |\n|Travis Scott  |5              |\n+--------------+---------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781488_56407859","id":"20211122-181159_2142949500","dateCreated":"2021-11-22T20:56:21+0300","dateStarted":"2021-11-25T12:11:28+0300","dateFinished":"2021-11-25T12:11:53+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:68"},{"text":"%pyspark\n\ndf_metrics = tracks\\\n.groupBy(\"name_artist\")\\\n.agg(\n    f.avg(\"danceability\").alias(\"mean_danceability\"),\n    f.avg(\"energy\").alias(\"mean_energy\"),\n    f.avg(\"speechiness\").alias(\"mean_speechiness\"),\n    f.avg(\"acousticness\").alias(\"mean_acousticness\"),   \n    f.avg(\"liveness\").alias(\"mean_liveness\"),\n    f.avg(\"valence\").alias(\"mean_valence\")\n    )\n\n\ndf_metrics.show()","user":"smykov","dateUpdated":"2021-11-25T12:11:53+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-------------------+-------------------+--------------------+--------------------+-------------------+-------------------+\n|         name_artist|  mean_danceability|        mean_energy|    mean_speechiness|   mean_acousticness|      mean_liveness|       mean_valence|\n+--------------------+-------------------+-------------------+--------------------+--------------------+-------------------+-------------------+\n|              *NSYNC| 0.6269387755102042| 0.7086734693877551| 0.08345102040816325| 0.17210632653061222|0.23171428571428576|  0.620265306122449|\n|         Ramon Tapia| 0.8067777777777778| 0.8121111111111111| 0.06073333333333334|0.011915222222222223|0.06664444444444445|0.49355555555555547|\n|          Snoop Dogg| 0.7568978102189783| 0.7354890510948904| 0.20053868613138673| 0.11198255474452552| 0.1890153284671533| 0.6289999999999998|\n|               LCNVL|              0.648|              0.769|               0.348|             0.00669|              0.115|              0.762|\n|           Mcrackins|              0.198|              0.977|              0.1535|0.020999999999999998|             0.3235|             0.7005|\n|              FeR BR|              0.736|              0.793|              0.0436|             1.87E-4|             0.0996|              0.856|\n|         Eva Cassidy|0.46454347826086956|0.24666739130434778| 0.04188478260869565|  0.6854891304347825|0.20024347826086952|0.30634782608695654|\n|        Yann Tiersen| 0.4415396825396825| 0.3192269841269841| 0.03992063492063492|  0.8578095238095236|0.12226031746031746| 0.3916809523809523|\n|              Pesado| 0.6135614035087719| 0.6698947368421053| 0.08688947368421054| 0.26514736842105263| 0.2904315789473685| 0.7643684210526314|\n|        Mani Hoffman| 0.7224999999999999|             0.6695|              0.0357|            4.225E-4|              0.264| 0.7150000000000001|\n|        Naijaballan3|              0.399|              0.614|               0.513|              0.0882|              0.455|              0.331|\n|               ปลื้ม| 0.6436666666666667|              0.449| 0.02946666666666667|  0.3077666666666667|0.22699999999999998| 0.2793333333333334|\n|         Silverstein|0.33130000000000004|             0.8878| 0.15188000000000001| 0.05445082999999999|             0.3248|             0.2278|\n|Robert Tear/Eliza...|             0.1725|             0.2425|              0.0451|               0.976|             0.2735|            0.05295|\n|    Parokya Ni Edgar| 0.5128235294117648| 0.6686372549019607| 0.08286176470588236|  0.3760949019607844| 0.2614215686274509|  0.622421568627451|\n|        Ziggy Marley|             0.7684|             0.5062|0.058499999999999996|             0.31166|            0.11376| 0.7491000000000001|\n|      Jarabe De Palo| 0.6899444444444446| 0.6558518518518519| 0.04419074074074074|  0.2612977962962963|0.17733148148148156| 0.5961851851851853|\n|Dashboard Confess...| 0.5301111111111111|  0.714111111111111| 0.03493333333333334| 0.15976666666666667|0.10484444444444445|0.29044444444444445|\n|        Generation X|              0.397| 0.8833333333333334| 0.11026666666666667|          0.02617425| 0.3516666666666666|              0.695|\n|     Johannes Brahms| 0.2934928725701944|0.15070799136069105| 0.04423110151187906|  0.9434146868250546|0.15357213822894172|0.22963585313174947|\n+--------------------+-------------------+-------------------+--------------------+--------------------+-------------------+-------------------+\nonly showing top 20 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637760703479_-1008283169","id":"20211124-163143_398510910","dateCreated":"2021-11-24T16:31:43+0300","dateStarted":"2021-11-25T12:11:53+0300","dateFinished":"2021-11-25T12:11:58+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:69"},{"text":"%pyspark\n\ndf_metrics.orderBy(\"mean_danceability\", ascending=False).select(\"name_artist\", \"mean_danceability\").show(3)\ndf_metrics.orderBy(\"mean_energy\", ascending=False).select(\"name_artist\", \"mean_energy\").show(3)\ndf_metrics.orderBy(\"mean_speechiness\", ascending=False).select(\"name_artist\", \"mean_speechiness\").show(3)\ndf_metrics.orderBy(\"mean_acousticness\", ascending=False).select(\"name_artist\", \"mean_acousticness\").show(3)\ndf_metrics.orderBy(\"mean_liveness\", ascending=False).select(\"name_artist\", \"mean_liveness\").show(3)\ndf_metrics.orderBy(\"mean_valence\", ascending=False).select(\"name_artist\", \"mean_valence\").show(3)","user":"smykov","dateUpdated":"2021-11-25T12:11:58+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+----------------+-----------------+\n|     name_artist|mean_danceability|\n+----------------+-----------------+\n|     xxrichbeats|            0.987|\n|Leonardo La Mark|            0.987|\n|  Spooner Street|            0.987|\n+----------------+-----------------+\nonly showing top 3 rows\n\n+----------------+-----------+\n|     name_artist|mean_energy|\n+----------------+-----------+\n|        Tinnitus|        1.0|\n| Rain Recordings|        1.0|\n|Epic Soundscapes|        1.0|\n+----------------+-----------+\nonly showing top 3 rows\n\n+--------------------+----------------+\n|         name_artist|mean_speechiness|\n+--------------------+----------------+\n|Lars Andreas Larssen|           0.966|\n|    Sabina Laurinova|           0.964|\n|     Francis Blanche|           0.964|\n+--------------------+----------------+\nonly showing top 3 rows\n\n+--------------------+------------------+\n|         name_artist| mean_acousticness|\n+--------------------+------------------+\n|       George Brunis|0.9960000000000001|\n|\"Cliffords Louisv...|0.9960000000000001|\n| Mrityunjoy Banerjee|             0.996|\n+--------------------+------------------+\nonly showing top 3 rows\n\n+--------------------+-------------+\n|         name_artist|mean_liveness|\n+--------------------+-------------+\n|Inti Illimani His...|        0.996|\n|   Grupo Bom Balanco|        0.995|\n|   Puerto Candelaria|        0.989|\n+--------------------+-------------+\nonly showing top 3 rows\n\n+-------------+------------+\n|  name_artist|mean_valence|\n+-------------+------------+\n|    Full Tone|         1.0|\n|Λάκης Γαβαλάς|         1.0|\n| John Doherty|       0.999|\n+-------------+------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637761203757_-1399240837","id":"20211124-164003_1994032301","dateCreated":"2021-11-24T16:40:03+0300","dateStarted":"2021-11-25T12:11:59+0300","dateFinished":"2021-11-25T12:12:29+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:70"},{"text":"%pyspark\n\ndf_tracks_mean = tracks\\\n.groupBy(\"release_year\")\\\n.agg(\n    f.avg(\"danceability\").alias(\"mean_danceability\"),\n    f.avg(\"energy\").alias(\"mean_energy\"),\n    f.avg(\"speechiness\").alias(\"mean_speechiness\"),\n    f.avg(\"acousticness\").alias(\"mean_acousticness\"),   \n    f.avg(\"liveness\").alias(\"mean_liveness\"),\n    f.avg(\"valence\").alias(\"mean_valence\")\n    )\n    \ndf_merged = tracks\\\n.join(df_tracks_mean, [\"release_year\"])\\\n.withColumn(\"norm_danceability\", col(\"danceability\") / col(\"mean_danceability\"))\\\n.withColumn(\"norm_energy\", col(\"energy\") / col(\"mean_energy\"))\\\n.withColumn(\"norm_speechiness\", col(\"speechiness\") / col(\"mean_speechiness\"))\\\n.withColumn(\"norm_acousticness\", col(\"acousticness\") / col(\"mean_acousticness\"))\\\n.withColumn(\"norm_liveness\", col(\"liveness\") / col(\"mean_liveness\"))\\\n.withColumn(\"norm_valence\", col(\"valence\") / col(\"mean_valence\"))\\\n.select(\n    \"name_artist\",\n    \"norm_danceability\",\n    \"norm_energy\",\n    \"norm_speechiness\", \n    \"norm_acousticness\", \n    \"norm_liveness\",\n    \"norm_valence\"\n    )\\\n.groupBy(\"name_artist\")\\\n.agg(\n    f.round(f.avg(\"norm_danceability\"), 2).alias(\"mean_norm_danceability\"),\n    f.round(f.avg(\"norm_energy\"), 2).alias(\"mean_norm_energy\"),\n    f.round(f.avg(\"norm_speechiness\"), 2).alias(\"mean_norm_speechiness\"),\n    f.round(f.avg(\"norm_acousticness\"), 2).alias(\"mean_norm_acousticness\"),   \n    f.round(f.avg(\"norm_liveness\"), 2).alias(\"mean_norm_liveness\"),\n    f.round(f.avg(\"norm_valence\"), 2).alias(\"mean_norm_valence\")\n    )","user":"smykov","dateUpdated":"2021-11-25T12:12:29+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[]},"apps":[],"jobName":"paragraph_1637765388183_-1773084345","id":"20211124-174948_273462089","dateCreated":"2021-11-24T17:49:48+0300","dateStarted":"2021-11-25T12:12:29+0300","dateFinished":"2021-11-25T12:12:31+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:71"},{"text":"%pyspark\n\ndf_merged.orderBy(\"mean_norm_danceability\", ascending=False).select(\"name_artist\", \"mean_norm_danceability\").show(3)\ndf_merged.orderBy(\"mean_norm_energy\", ascending=False).select(\"name_artist\", \"mean_norm_energy\").show(3)\ndf_merged.orderBy(\"mean_norm_speechiness\", ascending=False).select(\"name_artist\", \"mean_norm_speechiness\").show(3)\ndf_merged.orderBy(\"mean_norm_acousticness\", ascending=False).select(\"name_artist\", \"mean_norm_acousticness\").show(3)\ndf_merged.orderBy(\"mean_norm_liveness\", ascending=False).select(\"name_artist\", \"mean_norm_liveness\").show(3)\ndf_merged.orderBy(\"mean_norm_valence\", ascending=False).select(\"name_artist\", \"mean_norm_valence\").show(3)","user":"smykov","dateUpdated":"2021-11-25T13:07:18+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python","editorHide":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------+----------------------+\n| name_artist|mean_norm_danceability|\n+------------+----------------------+\n|    DiegoJHG|                  2.23|\n|Gayla Peevey|                  2.21|\n|   Baba Mama|                  2.17|\n+------------+----------------------+\nonly showing top 3 rows\n\n+--------------+----------------+\n|   name_artist|mean_norm_energy|\n+--------------+----------------+\n|1943 - Madison|            4.64|\n|         May 6|            4.64|\n|   InNeR ChiLd|             4.2|\n+--------------+----------------+\nonly showing top 3 rows\n\n+--------------+---------------------+\n|   name_artist|mean_norm_speechiness|\n+--------------+---------------------+\n|   James Young|                16.09|\n|     Yogi Bear|                13.66|\n|Manos Katrakis|                13.62|\n+--------------+---------------------+\nonly showing top 3 rows\n\n+---------------+----------------------+\n|    name_artist|mean_norm_acousticness|\n+---------------+----------------------+\n|     PianoBella|                  3.87|\n|Adelmar Borrego|                  3.87|\n| Gregory Oberle|                  3.87|\n+---------------+----------------------+\nonly showing top 3 rows\n\n+------------+------------------+\n| name_artist|mean_norm_liveness|\n+------------+------------------+\n|Ria Bhowmick|              5.68|\n|  Helen Ward|              5.55|\n|Alva & Noemi|              5.29|\n+------------+------------------+\nonly showing top 3 rows\n\n+--------------------+-----------------+\n|         name_artist|mean_norm_valence|\n+--------------------+-----------------+\n|Jazz Majestic Orc...|             2.97|\n|     Udutha Sarojini|             2.96|\n|    Humberto Morales|             2.94|\n+--------------------+-----------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637767981309_-1666325258","id":"20211124-183301_934566248","dateCreated":"2021-11-24T18:33:01+0300","dateStarted":"2021-11-25T12:12:31+0300","dateFinished":"2021-11-25T12:13:33+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:72"},{"text":"%pyspark\n\ncols = ['mean_norm_danceability', 'mean_norm_energy', 'mean_norm_speechiness', 'mean_norm_acousticness', 'mean_norm_liveness', 'mean_norm_valence']\n\nfor col in cols:\n    df_merged.orderBy(col, ascending=False).select(\"name_artist\", col).show(3)","user":"smykov","dateUpdated":"2021-11-25T13:06:02+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------+----------------------+\n| name_artist|mean_norm_danceability|\n+------------+----------------------+\n|    DiegoJHG|                  2.23|\n|Gayla Peevey|                  2.21|\n|   Baba Mama|                  2.17|\n+------------+----------------------+\nonly showing top 3 rows\n\n+--------------+----------------+\n|   name_artist|mean_norm_energy|\n+--------------+----------------+\n|1943 - Madison|            4.64|\n|         May 6|            4.64|\n|   InNeR ChiLd|             4.2|\n+--------------+----------------+\nonly showing top 3 rows\n\n+--------------+---------------------+\n|   name_artist|mean_norm_speechiness|\n+--------------+---------------------+\n|   James Young|                16.09|\n|     Yogi Bear|                13.66|\n|Manos Katrakis|                13.62|\n+--------------+---------------------+\nonly showing top 3 rows\n\n+---------------+----------------------+\n|    name_artist|mean_norm_acousticness|\n+---------------+----------------------+\n|     PianoBella|                  3.87|\n|Adelmar Borrego|                  3.87|\n| Gregory Oberle|                  3.87|\n+---------------+----------------------+\nonly showing top 3 rows\n\n+------------+------------------+\n| name_artist|mean_norm_liveness|\n+------------+------------------+\n|Ria Bhowmick|              5.68|\n|  Helen Ward|              5.55|\n|Alva & Noemi|              5.29|\n+------------+------------------+\nonly showing top 3 rows\n\n+--------------------+-----------------+\n|         name_artist|mean_norm_valence|\n+--------------------+-----------------+\n|Jazz Majestic Orc...|             2.97|\n|     Udutha Sarojini|             2.96|\n|    Humberto Morales|             2.94|\n+--------------------+-----------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637834697117_181202783","id":"20211125-130457_510023218","dateCreated":"2021-11-25T13:04:57+0300","dateStarted":"2021-11-25T13:06:02+0300","dateFinished":"2021-11-25T13:07:03+0300","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:73"},{"text":"%pyspark\nimport numpy as np\n\ncols = ['danceability', 'energy', 'speechiness', 'acousticness', 'liveness', 'valence']\n\n#tracks\\\n#.groupBy(\"release_year\")\\\n#.agg(\n#    [f.avg(col).alias(\"mean_{}\".format(col)) for col in cols]\n#)\\\n#.show()","user":"smykov","dateUpdated":"2021-11-25T16:03:06+0300","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"editorMode":"ace/mode/python"},"settings":{"params":{},"forms":{}},"results":{"code":"ERROR","msg":[{"type":"TEXT","data":"Fail to execute line 6:     [f.avg(col).alias(\"mean_{}\".format(col)) for col in cols]\nTraceback (most recent call last):\n  File \"/tmp/zeppelin_pyspark-1863587000190044143.py\", line 380, in <module>\n    exec(code, _zcUserQueryNameSpace)\n  File \"<stdin>\", line 6, in <module>\n  File \"/usr/lib/spark/python/lib/pyspark.zip/pyspark/sql/group.py\", line 91, in agg\n    assert all(isinstance(c, Column) for c in exprs), \"all exprs should be Column\"\nAssertionError: all exprs should be Column\n"}]},"apps":[],"jobName":"paragraph_1637834998745_1593185031","id":"20211125-130958_472257961","dateCreated":"2021-11-25T13:09:58+0300","dateStarted":"2021-11-25T16:01:08+0300","dateFinished":"2021-11-25T16:01:08+0300","status":"ERROR","progressUpdateIntervalMs":500,"$$hashKey":"object:74"},{"title":"*2.4. Для каждой аудиохарактеристики вывести топ 3 артистов по среднему значению каждой аудиохарактеристики его песен. Дополнительно: отнормировать на среднее значение аудиохарактеристики в год выхода песен.","text":"%pyspark\n","user":"smykov","dateUpdated":"2021-11-25T12:13:33+0300","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"editorHide":false,"title":true,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+------------+----------------------+\n|name_artist |norm_danceability_mean|\n+------------+----------------------+\n|DiegoJHG    |2.25                  |\n|Gayla Peevey|2.19                  |\n|Baba Mama   |2.19                  |\n+------------+----------------------+\nonly showing top 3 rows\n\n+---------------+----------------------+\n|name_artist    |norm_acousticness_mean|\n+---------------+----------------------+\n|PianoBella     |3.83                  |\n|Gregory Oberle |3.83                  |\n|Adelmar Borrego|3.83                  |\n+---------------+----------------------+\nonly showing top 3 rows\n\n+--------------+----------------+\n|name_artist   |norm_energy_mean|\n+--------------+----------------+\n|May 6         |4.75            |\n|1943 - Madison|4.75            |\n|InNeR ChiLd   |4.26            |\n+--------------+----------------+\nonly showing top 3 rows\n\n+--------------+---------------------+\n|name_artist   |norm_speechiness_mean|\n+--------------+---------------------+\n|James Young   |15.6                 |\n|Manos Katrakis|14.64                |\n|Yogi Bear     |13.63                |\n+--------------+---------------------+\nonly showing top 3 rows\n\n+------------+------------------+\n|name_artist |norm_liveness_mean|\n+------------+------------------+\n|Ria Bhowmick|5.74              |\n|Helen Ward  |5.41              |\n|Alva & Noemi|5.35              |\n+------------+------------------+\nonly showing top 3 rows\n\n+-----------------------+-----------------+\n|name_artist            |norm_valence_mean|\n+-----------------------+-----------------+\n|Jazz Majestic Orchestra|2.94             |\n|Udutha Sarojini        |2.93             |\n|Humberto Morales       |2.91             |\n+-----------------------+-----------------+\nonly showing top 3 rows\n\n"}]},"apps":[],"jobName":"paragraph_1637603781494_2060591427","id":"20211122-175857_40251242","dateCreated":"2021-11-22T20:56:21+0300","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:75"}],"name":"it_3/smykov/3 hw 1","id":"2GPCU8NS7","noteParams":{},"noteForms":{},"angularObjects":{"sparkLocal:shared_process":[],"md:shared_process":[],"python:shared_process":[],"spark::2GPCU8NS7":[],"sh:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}